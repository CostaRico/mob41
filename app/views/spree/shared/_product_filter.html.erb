<% filters = @taxon ? @taxon.applicable_filters : [Spree::Core::ProductFilters.all_taxons] %>
<% unless filters.empty? %>
  <%= form_tag '', method: :get, id: 'sidebar_products_search' do %>
    <%= hidden_field_tag 'per_page', params[:per_page] %>
    <% filters.each do |filter| %>
      <% labels = filter[:labels] || filter[:conds].map {|m,c| [m,m]} %>
      <% next if labels.empty? %> 
      <div class="dropdown" style="display: inline;">
      <button class="dLabel" type="button"  aria-haspopup="true" aria-expanded="false" style="border-radius: 1.143em; display: inline; margin: 0.286em; cursor: pointer;">
       <%= filter[:name] %>
       <span class="caret"></span>
       </button>  
        <ul class="dropdown-menu filter-menu" aria-labelledby="dLabel">
          <div class="list">
            <% labels.each do |nm,val| %>
              <% label = "#{filter[:name]}_#{nm}".gsub(/\s+/,'_') %>
                <li class="filter-pos">
                  <label  for="<%= label %>" class="l-f">
                  <input type="checkbox"
                         id="<%= label %>"
                         name="search[<%= filter[:scope].to_s %>][]"
                         value="<%= val %>"
                         <%= params[:search].present? && params[:search][filter[:scope]] && params[:search][filter[:scope]].include?(val.to_s) ? "checked" : "" %> >
                   <%= nm %> 
                   </label>
                 </li>
              <% end %>
            </div>
            <%= submit_tag "Применить", name: nil, class: 'button btn-filter' %>
          </ul>
        </div>
    <% end %>
    
  <% end %>
<% end %>
<script type="text/javascript">
  $(document).ready(function () {
    $('.dLabel').on('click', function() {
      if ($(this).parent().hasClass("open")){
        $(this).parent().removeClass('open');
      }
      else{
        $('.dLabel').parent().removeClass('open');
        $(this).parent().toggleClass('open');
      }
    });
    // $(document).click( function(event){
    //   if( $(event.target).closest(".filter-menu").length ) 
    //     return;
    //   $(".filter-menu").fadeOut("slow");
    //   event.stopPropagation();
    // });
    // $('#menuwrap').click(function(event){
    //      event.stopPropagation();
    // })
    // $(".dropdown").on("hide.bs.dropdown", function(){
    // $(".btn").html('Dropdown <span class="caret"></span>');
    //   });
    //   $(".dropdown").on("show.bs.dropdown", function(){
    //     $(".btn").html('Dropdown <span class="caret caret-up"></span>');
    //   });
    
  });
</script>